//controller

  int teamCounter = 0;
                        List<TaskInfo> _newInfo = new List<TaskInfo>();

                        foreach (var teamGroup in teamCollection)
                        {
                            string teamname = teamGroup.TeamName;

                            int teamDateMaxCount = _info.Where(x => x.TeamName == teamname).GroupBy(x => x.EndDateInt.Value)
                                                 .Max(g => g.Count());
                            int counter = 1;
                            string oldValue = "";
                            var SortedList = _info.Where(x => x.TeamName == teamname).OrderBy(x => x.EndDateInt.Value.Date.Ticks);
                            foreach (var item in SortedList)
                            {
                                if (oldValue != item.EndDateInt.Value.ToShortDateString())
                                {
                                    counter = 1;
                                }
                                else
                                {
                                    counter++;
                                }
                                oldValue = item.EndDateInt.Value.ToShortDateString();
                                item.value = teamCounter + counter;
                                item.extra = color.Where(x => x.name == teamname).First().value.ToString();
                                _newInfo.Add(item);

                            }
                            teamCounter += teamDateMaxCount;
                        }
                        //here customise column name
                        var output = from i in _newInfo
                                     select new
                                     {
                                         TaskTitle = i.TaskName,
                                         TaskNumber = i.value,
                                         TaskDate = i.EndDateInt?.ToString("dd-MMM-yyyy"),
                                         TaskId = i.WorkbasketTaskId,
                                         extra = i.extra,
                                         DependsOnWorkbasketTaskId = i.DependsOnWorkbasketTaskId,
                                         DependantTaskDate = _newInfo.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).Count() > 0 ? _newInfo.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).FirstOrDefault().EndDateInt?.ToString("dd-MMM-yyyy") : i.EndDateInt?.ToString("dd-MMM-yyyy"),
                                         DependantTaskNumber = _newInfo.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).Count() > 0 ? _newInfo.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).FirstOrDefault().value : i.value,
                                         DependantTaskName = _newInfo.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).Count() > 0 ? _newInfo.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).FirstOrDefault().TaskName : "",
                                         color = _newInfo.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).Count() > 0 ? (i.EndDateInt >= _info.Where(x => x.WorkbasketTaskId == i.DependsOnWorkbasketTaskId).FirstOrDefault().EndDateInt ? "rgb(44, 160, 44)" : "rgb(214, 39, 40)") : "rgb(214, 39, 40)", //green/red color
                                         TeamName = i.TeamName,
                                        IsDependantTask=i.IsDependantTask,
                                     };
                                     
                                     
                                     //Service
                                     
                                     
            public List<TaskInfo> GetTaskTimelineChartReport(int LocationId, int PeriodId, int tenantId)
            {
                //var result = (from WorkbasketTask in context.WorkbasketTasks
                //                        join Period in context.Periods
                //                        on WorkbasketTask.PeriodId equals Period.Id
                //                        join PeriodDay in context.PeriodDays
                //                        on Period.Id equals PeriodDay.PeriodId
                //                        join WorkbasketTaskUsers in context.WorkbasketTaskUsers
                //                        on WorkbasketTask.Id equals WorkbasketTaskUsers.WorkbasketTaskId
                //                        join DependentTask in context.DependentTasks
                //                        on WorkbasketTask.TaskId equals DependentTask.TaskId into DependentTaskinfo
                //                        from DependentTask in DependentTaskinfo.DefaultIfEmpty()
                //                        join Team in context.Teams
                //                        on WorkbasketTask.TeamId equals Team.Id into teaminfo
                //                        from Team in teaminfo.DefaultIfEmpty()
                //                        join Task in context.Tasks
                //                        on WorkbasketTask.TaskId equals Task.Id into taskinfo
                //                        from Task in taskinfo.DefaultIfEmpty()
                //                        where (WorkbasketTask.TaskId != null) && (WorkbasketTaskUsers.EndDateInt != null) && (Period.PeriodText == PeriodText) && (Period.LocationId == LocationId) && (WorkbasketTask.TenantId == tenantId)
                //                        group WorkbasketTask by new
                //                        {
                //                            WorkbasketTask.TeamId,
                //                            Team.TeamName,
                //                            Task.TaskName,
                //                            WorkbasketTask.TaskId,
                //                            DependentTask.DependentTaskId,
                //                            WorkbasketTaskUsers.EndDateInt
                //                        } into gcs
                //                        select new
                //                        {
                //                            TeamId = (gcs.Key.TeamId == null) ? 0 : gcs.Key.TeamId,
                //                            TeamName = (gcs.Key.TeamName == null) ? "" : gcs.Key.TeamName,
                //                            TaskName = (gcs.Key.TaskName == null) ? "" : gcs.Key.TaskName,
                //                            TaskId = (gcs.Key.TaskId == null) ? 0 : gcs.Key.TaskId,
                //                            DependantTaskId = (gcs.Key.DependentTaskId == null) ? gcs.Key.TaskId : gcs.Key.DependentTaskId,
                //                            EndDate = gcs.Max(x => (gcs.Key.EndDateInt == null) ? "01/01/2000" : gcs.Key.EndDateInt.ToString()),
                //                            value = "",
                //                            extra = ""
                //                        }).ToList<dynamic>();


                eClose_TestingEntities context = new eClose_TestingEntities();
                TaskInfo list1 = new TaskInfo();
                list1.list = (from DependetWorkbasketTask in context.DependetWorkbasketTasks
                              join WorkbasketTask in context.WorkbasketTasks
                              on DependetWorkbasketTask.WorkbasketTaskId equals WorkbasketTask.Id
                              join Period in context.Periods
                              on WorkbasketTask.PeriodId equals Period.Id
                              join PeriodDays in context.PeriodDays
                              on Period.Id equals PeriodDays.PeriodId
                              join Team in context.Teams
                              on WorkbasketTask.TeamId equals Team.Id
                              join WorkbasketTaskUsers in context.WorkbasketTaskUsers
                              on WorkbasketTask.Id  equals WorkbasketTaskUsers.WorkbasketTaskId
                              //                              where (Period.LocationId == LocationId) && (Period.Id == PeriodId) && (WorkbasketTask.TenantId == tenantId)
                              group DependetWorkbasketTask by new
                              {
                                  WorkbasketTaskUsers.EndDateInt,
                                  DependetWorkbasketTask.WorkbasketTaskId,
                                  DependetWorkbasketTask.DependsOnWorkbasketTaskId,
                                  WorkbasketTask.TaskName,
                                  Team.TeamName
                              } into gcs
                              select new TaskInfo
                              {
                                  //TeamId = (gcs.Key.TeamId == null) ? 0 : gcs.Key.TeamId,
                                  TeamName = (gcs.Key.TeamName == null) ? "" : gcs.Key.TeamName,
                                  TaskName = (gcs.Key.TaskName == null) ? "" : gcs.Key.TaskName,
                                  WorkbasketTaskId = (gcs.Key.WorkbasketTaskId == null) ? 0 : gcs.Key.WorkbasketTaskId,
                                  DependsOnWorkbasketTaskId = gcs.Key.DependsOnWorkbasketTaskId,
                                  EndDateInt = gcs.Max(x => (gcs.Key.EndDateInt == null) ? DateTime.Today : gcs.Key.EndDateInt),
                                  value = 0,
                                  extra = "",
                                  IsDependantTask = false
                              }).ToList<TaskInfo>();


                IEnumerable<int?> DependsOnWorkbasketTaskIdList;
                DependsOnWorkbasketTaskIdList = list1.list.Select(t => t.DependsOnWorkbasketTaskId);

                TaskInfo list3 = new TaskInfo();
                list3.list = (from WorkbasketTask in context.WorkbasketTasks
                              join DependetWorkbasketTask in context.DependetWorkbasketTasks
                              on WorkbasketTask.Id equals DependetWorkbasketTask.WorkbasketTaskId into DependetWorkbasketTaskinfo
                              from DependetWorkbasketTask in DependetWorkbasketTaskinfo.DefaultIfEmpty()
                              join Period in context.Periods
                              on WorkbasketTask.PeriodId equals Period.Id into Periodinfo
                              from Period in Periodinfo.DefaultIfEmpty()
                              join PeriodDays in context.PeriodDays
                              on Period.Id equals PeriodDays.PeriodId into PeriodDaysinfo
                              from PeriodDays in PeriodDaysinfo.DefaultIfEmpty()
                              join Team in context.Teams
                              on WorkbasketTask.TeamId equals Team.Id into Teaminfo
                              from Team in Teaminfo.DefaultIfEmpty()
                              join WorkbasketTaskUsers in context.WorkbasketTaskUsers
                              on WorkbasketTask.Id equals WorkbasketTaskUsers.WorkbasketTaskId into WorkbasketTaskUsersinfo
                              from WorkbasketTaskUsers in WorkbasketTaskUsersinfo.DefaultIfEmpty()
                              join record in DependsOnWorkbasketTaskIdList
                              on WorkbasketTask.Id equals record
                              group DependetWorkbasketTask by new
                              {
                                  WorkbasketTaskUsers.EndDateInt,
                                  WorkbasketTask.Id,
                                  DependetWorkbasketTask.DependsOnWorkbasketTaskId,
                                  WorkbasketTask.TaskName,
                                  Team.TeamName
                              } into gcs
                              select new TaskInfo
                              {
                                  //TeamId = (gcs.Key.TeamId == null) ? 0 : gcs.Key.TeamId,
                                  TeamName = (gcs.Key.TeamName == null) ? "" : gcs.Key.TeamName,
                                  TaskName = (gcs.Key.TaskName == null) ? "" : gcs.Key.TaskName,
                                  WorkbasketTaskId = (gcs.Key.Id == null) ? 0 : gcs.Key.Id,
                                  DependsOnWorkbasketTaskId = (gcs.Key.DependsOnWorkbasketTaskId == null) ? gcs.Key.Id : gcs.Key.DependsOnWorkbasketTaskId,
                                  EndDateInt = gcs.Max(x => (gcs.Key.EndDateInt == null) ? DateTime.Today : gcs.Key.EndDateInt),
                                  value = 0,
                                  extra = "",
                                   IsDependantTask = true
                              }).ToList<TaskInfo>();
                List<TaskInfo> TaskList = new List<TaskInfo>();
                TaskList.AddRange(list1.list.ToList());
                TaskList.AddRange(list3.list.ToList());
                return TaskList;
            }
//view 

 $.each(Data, function (index, value) {
                            if (value.TaskTitle == value.DependantTaskName && value.TaskId == value.DependsOnWorkbasketTaskId) {
                                value.DependantTaskName = "";
                                value.DependsOnWorkbasketTaskId = "";
                            }
                            if(value.IsDependantTask == false)
                            {
                            rows += "<tr><td>" + value.TaskId + "</td><td>" + value.TaskTitle
                                + "</td><td>" + value.TaskDate + "</td><td>" + value.DependsOnWorkbasketTaskId
                                + "</td><td>" + value.DependantTaskDate + "</td><td>" + value.DependantTaskName + "</td></tr>";
                            }
                            if ($.inArray(value.TeamName, TeamNames) == -1) {
                                TeamNames.push(value.TeamName);
                            }

                            if ($.inArray(value.TaskDate, TaskEndDates) == -1) {
                                TaskEndDates.push(value.TaskDate);
                            }

                        });
