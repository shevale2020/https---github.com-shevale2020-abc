
@using ECloseWebApp.Models;
@using ECloseWebApp.BuisnessEntities;
@using ECloseBL.Entities;
@model ECloseWebApp.Models.ViewModelForBusinessUnitDD
@{
    ViewBag.Title = "SummaryReport";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

 
/*.table th{
text-align:center !important;
}*/
/*.sidebar {
    width: 0px;
}*/
 
/*.text-orange {
    color: orange;
}*/

/*a.disabled {
    pointer-events: none;
    cursor: default;
}*/
 
/*.Custom-height {
    height: 25px;
}*/ 

/*.fixed-table-container thead th .th-inner,
.fixed-table-container tbody td .th-inner {
    padding: 4px;
    line-height: 24px;
    vertical-align: top;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.fixed-table-toolbar .bs-bars,
.fixed-table-toolbar .search,
.fixed-table-toolbar .columns {
    position: relative;
    margin-top: 0px;
    margin-bottom: 10px;
    line-height: 34px;
}

.dropup .caret,
.navbar-fixed-bottom .dropdown .caret {
    border-top: 0 dotted;
    border-bottom: 0px;
    content: "";
}

.table-processor thead > tr > th,
.table-processor tbody > tr > th,
.table-processor tfoot > tr > th,
.table-processor thead > tr > td,
.table-processor tbody > tr > td,
.table-processor tfoot > tr > td {
    padding: 4px; /* this is changed form 8 to 4px */
    /*line-height: 1.428571429;
    vertical-align: top;
    font-size: 13px;
}

.table-color-tpw-th1 {
    background-color: steelblue;
    color: white;
}

.table-color-tpw-th2 {
    background-color: limegreen;
    color: white;
}

.table-color-tpw-th3 {
    background-color: red;
    color: white;
}

.table-color-tpw-th4 {
    background-color: darkorange;
    color: white;
}

.table-color-bookng {
    background-color: #8e5ea2;
    color: white;
}

.table-color-val {
    background-color: #3cba9f;
    color: white;
}

.table-color-pay {
    background-color: #c45850;
    color: white;
}

.padding-left-zero {
    padding-left: 0px;
}

.th-color-light-green {
    background-color: #869b51;
    color: white;
}*/

.fixed-table-container thead .thead-rotate .th-inner {
  padding: 0px;
  /*overflow: hidden;*/
  line-height: 6px !important;
  text-overflow: ellipsis;
  vertical-align:middle;

   transform: rotate(-90deg);
 -webkit-transform: rotate(-90deg); /* Safari/Chrome */
 -moz-transform: rotate(-90deg); /* Firefox */
 -o-transform: rotate(-90deg); /* Opera */
 -ms-transform: rotate(-90deg);
  /*white-space: nowrap;*/
  margin:inherit;
  margin-left:-95px;
  position:absolute;
  width:215px;
  height:10px;
  /*padding-bottom:20px;*/
  text-align:center;
}


.table-bordered thead .th-headsize{
     color:#34425a !important;
    padding: 0px 0px ; 
    border: 0;
    /*font-weight: 300 !important;*/    
        border: 1px solid #ddd;
         vertical-align:middle; 
         /*background-color:darkcyan !important;*/
}


    #tblTaskRecord th {
        /*padding: 0px !important;
        margin: 0px !important;*/
        font-size: 13px;
        color: #34425a;
        font-weight: 600;
        background-color: #17c4bb;
        border-right: 1px solid #6dd2cd;
        border-radius: 0;
         vertical-align:middle; 
        text-align:center;
    }
    .thGreen{
       
        background-color:#80ffaa !important;
    }
    .thRed{
        
       
        background-color:#ff8080 !important;
    }

    #tblTaskRecord td {
        padding: 4px !important;
        margin: 0px !important;
        font-size: 13px;
        border: 1px solid #ddd;
    }

    thead th .th-inner {
       height:130px;
       vertical-align:middle;
       
    }
    .thheadcolor{
        height:10px;
        background-color:cornflowerblue !important;
    }
    .table thead tr th {
       
        padding:30px;
      height:auto;
        }
    /*.fixed-table-body {
        height: auto !important;
        overflow-x: auto;
        overflow-y: auto;
    }*/

    .pagination > .active > a {
    background: #17c4bb;
    border-color:#0c9c95;
    }
</style>
<link href="~/Content/bootstrap-table.min.css" rel="stylesheet" />

<div class="panel panel-white">
    <div class="panel-body">
        <div class="row">
            <div class="col-md-3">
                <div class="form-group  no-m">
                    <label title="" >
                        Period:
                    </label>
                    @Html.DropDownListFor(m => m.Period, Model.Period, new { @class = "form-control" })
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group  ">
                    <label title="" >
                        @LableConstants.LocationLable :
                    </label>
                    @Html.DropDownListFor(m => m.Location, Model.Location, new { @class = "form-control" })
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group  ">
                    <label title="" >
                        @LableConstants.TeamLable :
                    </label>
                    @Html.DropDownListFor(m => m.Team, Model.Team, new { @class = "form-control" })
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group  ">
                    <label title="">
                        Date :
                    </label>
                    <div class='input-group date' id='datetimepickerSummary'>
                        <input type='text' class="form-control" name="datepicker" id="summaryDate" onkeydown="return false;" onpaste="return false;" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar">
                            </span>
                        </span>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="panel-footer">
        <button id="btnSummaryReport" class="btn btn-primary" type="button"><span id="btnSummaryReport">Generate SummaryReport</span></button>
    </div>
</div>


<div id="summaryReport" style="margin-top: 1%;">
    <div class="panel-body">
        <div class="row">
            <div class="bootstrap-table">
                
              
                        @*<p id="summaryTitle" style="font-weight: 300;font-size: 17px;">Summary Report</p>*@
                        <table id="tblTaskRecord"
                               data-show-toggle="false"
                               data-search="false"
                               data-pagination="false"
                               data-sort-name="LocationName"
                               @*data-show-columns="true"*@
                               @*data-page-size="10"
                   data-page-list="[10, 25, 50, 100, ALL]"*@
                               hidden class="table fixed-table-container dataTable">

                            <colgroup span="2"></colgroup>
                            <colgroup span="2"></colgroup>

                            <thead>

                                <tr>
                                    <td colspan="2"></td>
                                    <th colspan="2" scope="colgroup"  style="background-color:mintcream;"></th>
                                    <th colspan="6" scope="colgroup" class="thheadcolor" valign="middle" align="center">Past</th>
                                    <th colspan="5" scope="colgroup" class="thheadcolor" align="center">Today</th>
                                    <th colspan="5" scope="colgroup" class="thheadcolor" align="center">Future</th>
                                    <th colspan="2" scope="colgroup" style="background-color:mintcream"></th>
                                </tr>
                                <tr>
                                    <th data-field="TeamName" data-sortable="true" rowspan="1" colspan="1">
                                        @LableConstants.LocationLable
                                    </th>
                                    <th data-field="PeriodName" data-sortable="true" rowspan="1" colspan="1">
                                        Period
                                    </th>
                                    <th class="thead-rotate th-headsize thGreen"  rowspan="1" colspan="1" data-field="PastClosedWithinTAT" data-formatter="countFormat" data-sortable="false">
                                        Closed Within-TAT
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="PastClosedTATMissed" data-formatter="countFormat" data-sortable="false">
                                        Closed TAT-Missed
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="PastOpenOnHold" data-formatter="countFormat" data-sortable="false">
                                        Open On-Hold
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="PastOpenWIP" data-formatter="countFormat" data-sortable="false">
                                        Open WIP
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="PastOpenUnActioned" data-formatter="countFormat" data-sortable="false">
                                        Open Un-Actioned
                                    </th>
                                    <th class="thead-rotate th-headsize bg-blue-600"  rowspan="1" colspan="1" data-field="PastTotal" data-formatter="countFormat" data-sortable="false">
                                        Past Total
                                    </th>
                                    <th class="thead-rotate th-headsize thGreen"  rowspan="1" colspan="1" data-field="TodayClosedWithinTAT" data-formatter="countFormat" data-sortable="false">
                                        Closed Within-TAT
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="TodayOpenOnHold" data-formatter="countFormat" data-sortable="false">
                                        Open On-Hold
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="TodayOpenWIP" data-formatter="countFormat" data-sortable="false">
                                        Open WIP
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="TodayOpenUnActioned" data-formatter="countFormat" data-sortable="false">
                                        Open Un-Actioned
                                    </th>
                                    <th class="thead-rotate th-headsize bg-blue-600"  rowspan="1" colspan="1" data-field="TodayTotal" data-formatter="countFormat" data-sortable="false">
                                        Today Total
                                    </th>
                                    <th class="thead-rotate th-headsize thGreen"  rowspan="1" colspan="1" data-field="FutureClosedBeforeTAT" data-formatter="countFormat" data-sortable="false">
                                        Closed Before-TAT
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="FutureOpenOnHold" data-formatter="countFormat" data-sortable="false">
                                        Open On-Hold
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="FutureOpenWIP" data-formatter="countFormat" data-sortable="false">
                                        Open WIP
                                    </th>
                                    <th class="thead-rotate th-headsize thRed"  rowspan="1" colspan="1" data-field="FutureOpenUnActioned" data-formatter="countFormat" data-sortable="false">
                                        Open Un-Actioned
                                    </th>
                                    <th class="thead-rotate th-headsize bg-blue-600"  rowspan="1" colspan="1" data-field="FutureTotal" data-formatter="countFormat" data-sortable="false">
                                        Future Total
                                    </th>
                                    <th class="thead-rotate th-headsize bg-blue-600" rowspan="1" colspan="1" data-field="Total" data-formatter="countFormat" data-sortable="false">
                                        Total
                                    </th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>


                @*<table id="tblTaskRecord" 
                       data-show-toggle="false" 
                       data-search="false" 
                       data-pagination="false" 
                       data-sort-name="LocationName" 
                       class="table dataTable no-footer table-hover" 
                       aria-describedby="tblTaskRecord_info" 
                       style="width: 1207px;" 
                       role="grid">

                    <colgroup span="2"></colgroup>
                    <colgroup span="2"></colgroup>

                    <thead style="">
                        <tr role="row">
                        <th style="" colspan="2" rowspan="1"><div class="th-inner "></div>
                            <div class="fht-cell"></div></th>
                        <th class="thheadcolor" style="" colspan="6" rowspan="1">
                            <div class="th-inner ">Past</div><div class="fht-cell"></div></th>
                        <th class="thheadcolor" style="" colspan="5" rowspan="1"><div class="th-inner ">Today</div>
                            <div class="fht-cell"></div></th>
                        <th class="thheadcolor" style="" colspan="5" rowspan="1"><div class="th-inner ">Future</div>
                            <div class="fht-cell"></div></th>
                        <th style="" colspan="2" rowspan="1"><div class="th-inner "></div>
                            <div class="fht-cell"></div></th>
                        </tr>
                        <tr role="row">
                            <th style="width: 207px;" rowspan="1" colspan="1" data-field="TeamName" class="sorting_asc" tabindex="0" aria-controls="tblTaskRecord" aria-sort="ascending" > Location/BU </th>

                            <th style="width: 52px;" rowspan="1" colspan="1" data-field="PeriodName" class="sorting" tabindex="0" aria-controls="tblTaskRecord" > Period </th>

                            <th class="th-headsize thGreen sorting_disabled" style="width: 65px;" rowspan="1" colspan="1" data-field="PastClosedWithinTAT" > Closed Within-TAT</th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 64px;" rowspan="1" colspan="1" data-field="PastClosedTATMissed" >Closed TAT-Missed</th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 49px;" rowspan="1" colspan="1" data-field="PastOpenOnHold" >Open On-Hold  </th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 43px;" rowspan="1" colspan="1" data-field="PastOpenWIP" >Open WIP</th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 72px;" rowspan="1" colspan="1" data-field="PastOpenUnActioned" >Open Un-Actioned</th>

                            <th class="th-headsize bg-blue-600 sorting_disabled" style="width: 41px;" rowspan="1" colspan="1" data-field="PastTotal" > Past Total</th>

                            <th class="th-headsize thGreen sorting_disabled" style="width: 64px;" rowspan="1" colspan="1" data-field="TodayClosedWithinTAT" > Closed Within-TAT </th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 49px;" rowspan="1" colspan="1" data-field="TodayOpenOnHold" >Open On-Hold </th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 43px;" rowspan="1" colspan="1" data-field="TodayOpenWIP" >Open WIP </th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 72px;" rowspan="1" colspan="1" data-field="TodayOpenUnActioned" >Open Un-Actioned </th>

                            <th class="th-headsize bg-blue-600 sorting_disabled" style="width: 49px;" rowspan="1" colspan="1" data-field="TodayTotal" >Today Total </th>

                            <th class="th-headsize thGreen sorting_disabled" style="width: 62px;" rowspan="1" colspan="1" data-field="FutureClosedBeforeTAT" > Closed Before-TAT </th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 47px;" rowspan="1" colspan="1" data-field="FutureOpenOnHold" >Open On-Hold</th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 43px;" rowspan="1" colspan="1" data-field="FutureOpenWIP" > Open WIP </th>

                            <th class="th-headsize thRed sorting_disabled" style="width: 72px;" rowspan="1" colspan="1" data-field="FutureOpenUnActioned" >Open Un-Actioned</th>

                            <th class="th-headsize bg-blue-600 sorting_disabled" style="width: 54px;" rowspan="1" colspan="1" data-field="FutureTotal" >Future Total </th>

                            <th class="th-headsize bg-blue-600 sorting_disabled" style="width: 41px;" rowspan="1" colspan="1" data-field="Total" >Total</th>
                        </tr>
                    </thead>
                    <tbody>
                   </tbody>
                </table>*@
                  
                </div>
                </div>
        </div>

    </div>
<div class="row">
    <div id="myModal1" style="overflow: scroll; resize:both;" class="modal fade " aria-hidden="true">
        <div class="modal-dialog modal-lg fixed-height">
            <div class="modal-content" style="height:550px;width:1000px; overflow: scroll; resize:both;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <div id='myModalContent1'>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="~/Scripts/bootstrap-table.min.js"></script>

<script type="text/javascript">
    var tokenId = '@Html.AntiForgeryToken()';
    $('#inputEntity').hide();
    $('#LoadRecords').hide();
    $('#divFilter').hide();
    $("#moduleName").text('Reports / Summary Report');

    $(document).ready(function () {
        $("#summaryTitle").hide();
        $('#datetimepickerSummary').datetimepicker({
            format: 'DD-MMM-YYYY',
        });

        $("#Location").change(function () {
            var LocationId = $('#Location :selected').val();
            if (LocationId != 0) {
                $("#Team").attr('disabled', false);
                $.post('@Url.Action("GetTeamByLocationId", "Rollover")', { LocationId: LocationId, __RequestVerificationToken: $(tokenId).val() },
                function (results) {
                    $("#Team").empty();
                    $("#Team").append("<option value='0'>--All--</option>");
                    $.each(results.Options, function (index, value) {
                        $("#Team").append("<option value='" + value.Value + "'>" + value.DisplayText + "</option>");
                    });
                });
            }
            else {
                $("#Team").empty();
                $("#Team").append("<option value='-1'>--Select--</option>");
                $("#Team").attr('disabled', true);
            }
        });
    });
    function validatePeriod(PeriodText) {
        if (PeriodText != '--Select--')
        { return true; }
        else
        {
            Command: toastr["warning"]("Please select Period");
            return false;
        }
        return true;
    }

    function countFormat(value, row, index) {
        debugger;
        console.log(row);
        return '<a href="javascript:;" onclick="ShowDetails(this);" class="' + row + '">' + value + '</a>';
    }
    function ShowDetails(el) {
        console.log(el);
        var Date = $('#summaryDate').val();
        var index = el.parentElement.cellIndex;
        var rowHeader = el.closest('td').closest('tr').parentElement.previousElementSibling.firstElementChild.nextElementSibling.firstElementChild;
        var taskType = rowHeader.parentElement.children[index].closest('th').getAttribute('data-field');
        var str = el.parentNode.parentElement.firstElementChild.innerText;
        var locationName = str.split('_')[0];
        var teamName = str.split('_')[1];
        var PeriodText = el.parentNode.parentElement.firstElementChild.nextElementSibling.innerText;
        var PeriodId = $('#Period :selected').val();
        console.log(Date + 'date' + index + 'index' + rowHeader + 'rowHeader' + taskType + 'taskType' + locationName + 'locationName' + teamName + 'teamName')
        
        taskType = taskType.replace('\n', '');
        $.ajax({
            url: '@Url.Action("summarySubPopupDetail", "Report")',
            data: {locationName: locationName, teamName: teamName, taskType: taskType, inputDate: Date},
            type: "Get",
            contentType: "json",
            success: function (data) {
                $('#myModalContent1').html(data);
                //$('#myModal').modal(options);
                $('#myModal1').modal('show');
                return;
            },
            error: function () {
                alert("Dynamic content load failed.");
            }
        });
    }

    $("#btnSummaryReport").click(function () {
        $("#summaryTitle").show();
        var LocationId = $('#Location :selected').val();
        var PeriodText = $('#Period :selected').text();
        var PeriodId = $('#Period :selected').val();
        var TeamId = $('#Team :selected').val();
        var Date = $('#summaryDate').val();

        if (validatePeriod(PeriodText)) {
            $.ajax({
                url: 'Report/SummeryReport',
                type: 'POST',
                dataType: 'json',
                data: {InputDate:Date,LocationId:LocationId,PeriodId:PeriodId,TeamId:TeamId, __RequestVerificationToken: $(tokenId).val() },
                success: function (data) {
                    console.log(data);
                    SummaryTableData(data.Records);
                },
                error: function () {
                    // $dfd.reject();
                }
            });
        }
        function SummaryTableData(records) {
            if (records != null) {
                $('#tblTaskRecord').bootstrapTable({
                    data: records
                });
                $('#tblTaskRecord').removeAttr("hidden");
            }
        }
    });
</script>

