using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace WebApplication3.Controllers
{
    class TaskInfo
    {
        public  string title { get; set; }
        //value is used for calculate task number
        public int? value { get; set; }
        // task end date
        public string date { get; set; }
        //if any extra param to send
        public string extra { get; set; }
        public string TeamName { get; set; }


    }
    public class HomeController : Controller
    {
        public ActionResult Index()
        {
       

            return View();
        }

        public JsonResult filterdata()
        {
            //Create sample data
            List<TaskInfo> _info = new List<TaskInfo>();
            _info.Add(
             new TaskInfo
             {
                 title = "Task 1",
                 value = null,
                 date = "23/03/2017",
                 extra = "",
                 TeamName = "team3"
             });
            _info.Add(

            new TaskInfo
            {
                title = "Task 1",
                value = null,
                date = "24/03/2017",
                extra = "",
                TeamName = "team3"
            });
            _info.Add(
               new TaskInfo
               {
                   title = "Task 1",
                   value = null,
                   date = "26/04/2017",
                   extra = "",
                   TeamName = "team3"

               });

            _info.Add(
                new TaskInfo
                {
                    title = "Task 1",
                    value = null,
                    date = "21/03/2017",
                    extra = "",
                    TeamName = "team1"
                });
            _info.Add(

            new TaskInfo
            {
                title = "Task 1",
                value = null,
                date = "21/03/2017",
                extra = "",
                TeamName = "team1"
            });
            _info.Add(
               new TaskInfo
               {
                   title = "Task 1",
                   value = null,
                   date = "22/04/2017",
                   extra = "",
                   TeamName = "team2"

               });
            _info.Add(
               new TaskInfo
               {
                   title = "Task 2",
                   value = null,
                   date = "22/04/2017",
                   extra = "",
                   TeamName = "team2"

               });
            _info.Add(
               new TaskInfo
               {
                   title = "Task 1",
                   value = null,
                   date = "24/06/2017",
                   extra = "",
                   TeamName = "team2"

               });

            // logic for add value of task date wise task number assign ..same date it will 1,2,3,4 etc
            string teamOldValue = "";
 var teamCollection= (_info.GroupBy(x => x.TeamName)
                            .Select(TeamName => new
                            {
                                TeamName = TeamName.Key
                            }));
            int count = 0;
            var color = (teamCollection.Select(TeamName => new
                                        {
                                            value = count++,
                                            name = TeamName.TeamName
                                        })
                                          .ToList());

            int teamCounter = 0;
            foreach (var teamGroup in teamCollection)
            {

                string teamname =  teamGroup.TeamName;

                int teamDateMaxCount = _info.Where(x => x.TeamName == teamname).GroupBy(x => x.date)
                                     .Max(g => g.Count());
                int counter = 1;
                string oldValue = "";
                foreach (var item in _info.Where(x => x.TeamName == teamname).OrderBy(x => x.date))
                {
                    if (oldValue != item.date)
                    {
                        counter = 1;
                    }
                    else
                    {
                        counter++;
                    }
                    oldValue = item.date;
                    item.value = teamCounter+ counter;
                    item.extra = color.Where(x => x.name == teamname).First().value.ToString();
                }


                teamCounter += teamDateMaxCount;
            }
            

            //here customise column name
            var output = from i in _info
                         select new
                         {
                             TaskTitle = i.title,
                             TaskNumber = i.value,
                             TaskDate = i.date,
                             extra = i.extra
                         };

          


            return Json( JsonConvert.SerializeObject(output) , JsonRequestBehavior.AllowGet);



        }

    }

    
    
}
