select  p.locationId ,wfa.[Status]
,count(wbt.ID) 
from  WorkbasketTask wbt
 inner join Period p on wbt.PeriodId=p.Id
 inner join  WorkbasketTaskUsers wbusr on wbt.Id = wbusr.WorkbasketTaskId
 inner join  WorkflowActions wfa  on wbt.StatusId = wfa.Id
 inner join  WorkflowLevels wfl on wfl.WorkflowId=wbt.WorkflowId and wfl.[Level] = wfa.WorkflowLevel
 --where CONVERT(VARCHAR(20), wbusr.EndDateInt, 112) <'20180523'
 group by p.locationId,wfa.[Status]
 
 
 
 
 
 
 
 
 
 
 
 
 **********************************************
 
 
 
 
 
 
--Past Activity Total Task as on Date

Select  p.locationId,Count(wbt.Id) TotalCount
,  SUM ( CASE WHEN  hold.Id IS NOT NULL THEN 1 ELSE 0 END  )OnHold_COUNT
,  SUM ( CASE WHEN  reject.Id IS NOT NULL THEN 1 ELSE 0 END  )Reject_COUNT
from WorkBasketTask wbt 
		inner join Period p on wbt.PeriodId=p.Id
		inner join PeriodDays td on p.Id=td.PeriodId
		inner join Team tm on wbt.TeamId=tm.Id
        left join  WorkflowActions wfa  on wbt.StatusId = wfa.Id
        join  WorkflowLevels wfl on wfl.WorkflowId=wfa.WorkflowId and wfl.[Level] = wfa.WorkflowLevel
		right join WorkbasketTaskUsers wbtu on wbtu.[WorkbasketTaskId]=wbt.Id
		LEFT join OnHoldTask hold on hold.WorkbasketTaskId = wbt.Id
	    LEFT JOIN  RejectedTask reject on  reject.WorkbasketTaskId = wbt.Id
		inner join Location l on p.locationid=l.id
where CONVERT(VARCHAR(20), wbtu.EndDateInt, 112) <'20180523'
group by p.locationId


--Today's Activity Total Task as on Date

Select  p.locationId,Count(wbt.Id) TotalCount
,  SUM ( CASE WHEN  hold.Id IS NOT NULL THEN 1 ELSE 0 END  )OnHold_COUNT
,  SUM ( CASE WHEN  reject.Id IS NOT NULL THEN 1 ELSE 0 END  )Reject_COUNT

from WorkBasketTask wbt 
		inner join Period p on wbt.PeriodId=p.Id
		inner join PeriodDays td on p.Id=td.PeriodId
		inner join Team tm on wbt.TeamId=tm.Id
        left join  WorkflowActions wfa  on wbt.StatusId = wfa.Id
        join  WorkflowLevels wfl on wfl.WorkflowId=wfa.WorkflowId and wfl.[Level] = wfa.WorkflowLevel
		right join WorkbasketTaskUsers wbtu on wbtu.[WorkbasketTaskId]=wbt.Id
		LEFT join OnHoldTask hold on hold.WorkbasketTaskId = wbt.Id
	    LEFT JOIN  RejectedTask reject on  reject.WorkbasketTaskId = wbt.Id
		inner join Location l on p.locationid=l.id
where CONVERT(VARCHAR(20), wbtu.EndDateInt, 112) ='20180523'
group by p.locationId



--Future Activity Total Task as on Date

Select  p.locationId,Count(wbt.Id) TotalCount
,  SUM ( CASE WHEN  hold.Id IS NOT NULL THEN 1 ELSE 0 END  )OnHold_COUNT
,  SUM ( CASE WHEN  reject.Id IS NOT NULL THEN 1 ELSE 0 END  )Reject_COUNT

from WorkBasketTask wbt 
		inner join Period p on wbt.PeriodId=p.Id
		inner join PeriodDays td on p.Id=td.PeriodId
		inner join Team tm on wbt.TeamId=tm.Id
        left join  WorkflowActions wfa  on wbt.StatusId = wfa.Id
        join  WorkflowLevels wfl on wfl.WorkflowId=wfa.WorkflowId and wfl.[Level] = wfa.WorkflowLevel
		right join WorkbasketTaskUsers wbtu on wbtu.[WorkbasketTaskId]=wbt.Id
		LEFT join OnHoldTask hold on hold.WorkbasketTaskId = wbt.Id
	    LEFT JOIN  RejectedTask reject on  reject.WorkbasketTaskId = wbt.Id
		inner join Location l on p.locationid=l.id
where CONVERT(VARCHAR(20), wbtu.EndDateInt, 112) >'20180523'
group by p.locationId

