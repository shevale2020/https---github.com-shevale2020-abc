
@using ECloseWebApp.Models;
@using ECloseWebApp.BuisnessEntities;
@using ECloseBL.Entities;
@model ECloseWebApp.Models.ViewModelForBusinessUnitDD
@{
    ViewBag.Title = "SummaryReport";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
        .table th {
            text-align: center !important;
        }
        /*.sidebar {
        width: 0px;
    }*/





        .fixed-table-container thead th .th-inner,
        .fixed-table-container tbody td .th-inner {
            padding: 4px;
            line-height: 24px;
            vertical-align: top;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }



        .padding-left-zero {
            padding-left: 0px;
        }

        .th-color-light-red {
            background-color: red;
        }

        .th-color-light-green {
            background-color: forestgreen;
        }

        .th-color-light-yellow {
            background-color:#FF8C00;
            color:black !important;
        }

        th {
            background-color: rgb(109, 210, 205);
            color: black;
        }

        .th-color-light-peachpuff {
            background-color: #04918a;
            color: black ;
        }

        .th-color-light-cadetblue {
            background-color: cadetblue;
        }

        .fixed-table-container thead .rotate .th-inner {
            padding: 0px;
            overflow: hidden;
            line-height: 11px;
            text-overflow: ellipsis;
            vertical-align: top;
            transform: rotate(-90deg);
            -webkit-transform: rotate(-90deg); /* Safari/Chrome */
            -moz-transform: rotate(-90deg); /* Firefox */
            -o-transform: rotate(-90deg); /* Opera */
            -ms-transform: rotate(-90deg);
            /*white-space: nowrap;*/
            margin: inherit;
            margin-left: -85px;
            position: absolute;
            width: 215px;
            height: 8px;
            padding-bottom: 20px;
            text-align: center;
        }


        .table-bordered thead .th-headsize {
            color: #fff !important;
            padding: 100px 0px !important;
            border: 0;
            font-weight: 600 !important;
            border: 1px solid #ddd;
            text-align: center;
        }

         /*#activity {  
        text-align:center;border:1px solid #ccc;  
         }  
        #activity td{  
            text-align:center;border:1px solid #ccc;  
        }*/  
         #headerExport td{  
           cursor:pointer;  
           text-align:center;border:1px solid #ccc;  
           border:none;  
        }  
</style>



<link href="~/Content/bootstrap-table.min.css" rel="stylesheet" />
    @*<link href="~/Content/Site.css" rel="stylesheet" />*@
@*<link href="@Url.Content("~/Content/jquery.dataTables.min.css")" rel="stylesheet" type="text/css" />*@
<link href="~/Content/dataTables.bootstrap.css" rel="stylesheet" />
<div class="panel panel-white">
    <div class="panel-body">
        <div class="row">


            <div class="col-md-3">
                <div class="form-group  ">
                    <label title="">
                        @LableConstants.LocationLable :
                    </label>
                    @Html.DropDownListFor(m => m.Location, Model.Location, new { @class = "form-control" })
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group  no-m">
                    <label title="">
                        Period:
                    </label>
                    @Html.DropDownListFor(m => m.Period, Model.Period, new { @class = "form-control" })
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group  ">
                    <label title="">
                        @LableConstants.TeamLable :
                    </label>
                    @Html.DropDownListFor(m => m.Team, Model.Team, new { @class = "form-control" })
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group  ">
                    <label title="">
                        Date :
                    </label>
                    <div class='input-group date' id='datetimepickerSummary'>
                        <input type='text' class="form-control" name="datepicker" id="summaryDate" onkeydown="return false;" onpaste="return false;" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar">
                            </span>
                        </span>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="panel-footer">
        <button id="btnSummaryReport" class="btn btn-primary" type="button"><span id="btnSummaryReport">Generate SummaryReport</span></button>
        <button id="exportexcel" class="btn btn-primary" type="button"><span class="glyphicon glyphicon-export"></span>Export to Excel</button>
        <button id="exportpdf" class="btn btn-primary" type="button"><span class="fa fa-file-pdf-o"></span>Export to PDF</button>
    </div>
</div>


<div id="summaryReport" style="margin-top: 1%;">
    <div class="panel-body">
        <div class="row">
            <div class="bootstrap-table">
                <table>
                    <tr id="headerExport">
                        <td  align="right" ></td>
                        @*<td id="exportpdf"><img src="" title="Export to PDF" /></td>*@
                        @*<td id="exportimage"><img src="~/icons/png.png" title="Export to PNG" /></td>
                        <td id="exportcsv"><img src="~/icons/csv.png" title="Export to CSV" /></td>
                        <td id="exportword"><img src="~/icons/word.png" title="Export to Word" /></td>
                        <td id="exporttxt"><img src="~/icons/txt.png" title="Export to TXT" /></td>
                        <td id="exportxml"><img src="~/icons/xml.png" title="Export to XML" /></td>
                        <td id="exportppt"><img src="~/icons/ppt.png" title="Export to PPT" /></td>*@
                    </tr>
                </table>

                @*<p id="summaryTitle" style="font-weight: 300;font-size: 17px;">Summary Report</p>*@
                <table id="tblTaskRecord"
                       data-show-toggle="false"
                       data-sort-name="LocationName"
                       data-sort-order="asc"
                       data-search="true"
                       data-show-pagination-switch="true"
                       data-pagination="true"
                       data-page-list="[10, 25, 50, 100, ALL]"
                       data-page-size="25"
                       data-show-footer="false"
                       data-side-pagination="client"
                       data-show-export="true"
                       data-export-types="['excel', 'pdf']"
                       data-export-options='{
                          @*"fileName": "tableExport",
                          "worksheetName": "tableExport",
                          "htmlContent" : "true",*@
                          "jspdf": {
                            "autotable": {
                              "startY": 20,
                              "bodyStyles": {"valign": "top"},
                              "styles": {"overflow": "linebreak", "rowHeight": 20, "fontSize": 10, "font": "helvetica"},
                              "headerStyles": {"fillColor": [41, 128, 185]},
                              "tableWidth": "wrap",
                              "pageFormats":"letter"
                            }
                          }
                        }' 
                       @*data-show-columns="true"*@
                       @*data-page-size="10"
                   data-page-list="[10, 25, 50, 100, ALL]"*@
                       hidden class="table table-striped table-bordered dt-responsive"
                        style="font-size: 12px;">

                    <colgroup span="2"></colgroup>
                    <colgroup span="2"></colgroup>

                    <thead>

                        <tr class="row">

                            <td colspan="2"></td>
                            <th colspan="2" scope="colgroup"></th>
                            <th colspan="6" scope="colgroup" class="th-color-light-peachpuff ">Past Activities</th>
                            <th colspan="5" scope="colgroup" class="th-color-light-peachpuff ">Today Activities</th>
                            <th colspan="5" scope="colgroup" class="th-color-light-peachpuff ">Future Activities</th>
                            @*<th colspan="2" scope="colgroup" ></th>*@
                        </tr>
                        <tr class="row">
                            <th class="col-sm-3" data-field="TeamName" data-sortable="true">
                                Team
                            </th>
                            <th data-field="PeriodName" class="col-sm-1" align="center" data-sortable="true">
                                Period
                            </th>
                            <th class="rotate th-headsize th-color-light-green" data-field="PastClosedWithinTAT" data-formatter="countFormat" data-sortable="false">
                                Closed Within-TAT
                            </th>
                            <th class="rotate th-headsize th-color-light-red" data-field="PastClosedTATMissed" data-formatter="countFormat" data-sortable="false">
                                Closed TAT-Missed
                            </th>
                            <th class="rotate th-headsize th-color-light-red" data-field="PastOpenOnHold" data-formatter="countFormat" data-sortable="false">
                                Open On-Hold
                            </th>
                            <th class="rotate th-headsize th-color-light-red" data-field="PastOpenWIP" data-formatter="countFormat" data-sortable="false">
                                Open WIP
                            </th>
                            <th class="rotate th-headsize th-color-light-red" data-field="PastOpenUnActioned" data-formatter="countFormat" data-sortable="false">
                                Open Un-Actioned
                            </th>
                            <th class="rotate th-headsize th-color-light-cadetblue " data-field="PastTotal" data-formatter="countFormat" data-sortable="false">
                                Total
                            </th>
                            <th class="rotate th-headsize th-color-light-green" data-field="TodayClosedWithinTAT" data-formatter="countFormat" data-sortable="false">
                                Closed Within-TAT
                            </th>
                            <th class="rotate th-headsize th-color-light-green" data-field="TodayOpenOnHold" data-formatter="countFormat" data-sortable="false">
                                Open On-Hold
                            </th>
                            <th class="rotate th-headsize th-color-light-green" data-field="TodayOpenWIP" data-formatter="countFormat" data-sortable="false">
                                Open WIP
                            </th>
                            <th class="rotate th-headsize th-color-light-yellow" data-field="TodayOpenUnActioned" data-formatter="countFormat" data-sortable="false">
                                Open Un-Actioned
                            </th>
                            <th class="rotate th-headsize th-color-light-cadetblue " data-field="TodayTotal" data-formatter="countFormat" data-sortable="false">
                                Total
                            </th>
                            <th class="rotate th-headsize th-color-light-green" data-field="FutureClosedBeforeTAT" data-formatter="countFormat" data-sortable="false">
                                Closed Before-TAT
                            </th>
                            <th class="rotate th-headsize" data-field="FutureOpenOnHold" data-formatter="countFormat" data-sortable="false">
                                Open On-Hold
                            </th>
                            <th class="rotate th-headsize" data-field="FutureOpenWIP" data-formatter="countFormat" data-sortable="false">
                                Open WIP
                            </th>
                            <th class="rotate th-headsize" data-field="FutureOpenUnActioned" data-formatter="countFormat" data-sortable="false">
                                Open Un-Actioned
                            </th>
                            <th class="rotate th-headsize th-color-light-cadetblue" data-field="FutureTotal" data-formatter="countFormat" data-sortable="false">
                                Total
                            </th>
                            @*<th class="rotate th-headsize bg-blue-600" rowspan="1" colspan="1" data-field="Total" data-formatter="countFormat" data-sortable="false">
                                    Total
                                </th>*@
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

            </div>
        </div>
    </div>

</div>
<div class="row">
    <div id="myModal1" style="overflow: scroll; resize:both;" class="modal fade " aria-hidden="true">
        <div class="modal-dialog modal-lg fixed-height">
            <div class="modal-content" style="height:550px;width:1000px; overflow: scroll; resize:both;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <div id='myModalContent1'>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
@*<script src="~/Scripts/datatables.js"></script>
<script src="~/Scripts/datatables.min.js"></script>*@
@*<link href="~/bootstrap/css/bootstrap.css" rel="stylesheet" />*@
<script src="~/bootstrap/js/bootstrap.js"></script>
<script src="~/Scripts/bootstrap-table.min.js"></script>
<script src="~/Scripts/bootstrap-table-export.js"></script>
<script src="~/Scripts/FileSaver.min.js"></script>
<script src="~/Scripts/jspdf.min.js"></script>
@*<script src="~/Scripts/jspdf.js"></script>*@
<script src="~/Scripts/jspdf.plugin.autotable.js"></script>
<script src="~/Scripts/html2canvas.js"></script>
<script src="~/Scripts/tableExport.js"></script>
<script src="~/Scripts/base64.js"></script>
<script src="~/Scripts/sprintf.js"></script>
<script src="~/Scripts/dataTables.bootstrap.js"></script>
<script src="~/Scripts/jquery.base64.js"></script>




<script type="text/javascript">
    var tokenId = '@Html.AntiForgeryToken()';
    $('#inputEntity').hide();
    $('#LoadRecords').hide();
    $('#divFilter').hide();
    $("#moduleName").text('Reports / Summary Report');
    
   
    $(document).ready(function () {

        $('#exportexcel').bind('click', function (e) {
            $('#tblTaskRecord').tableExport({ type: 'excel', escape: 'false' });
        });
        $('#exportpdf').bind('click', function (e) {
            $('#tblTaskRecord').tableExport({ type: 'pdf', escape: 'false' });
        });

        $("#summaryTitle").hide();
        $('#datetimepickerSummary').datetimepicker({
            format: 'DD-MMM-YYYY',
        });

        $.post('@Url.Action("GetPeriodByTenantId", "Report")', { __RequestVerificationToken: $(tokenId).val() },
                  function (results) {
                      $("#Period").empty();
                      $("#Period").append("<option value='0'>--Select--</option>");
                      $.each(results.Options, function (index, value) {
                          $("#Period").append("<option value='" + value.Value + "'>" + value.DisplayText + "</option>");

                      });
                  });


        $("#Location").change(function () {
            var LocationId = $('#Location :selected').val();


            if (LocationId != 0) {
                $.post('@Url.Action("GetPeriodByLocationId", "Rollover")', { LocationId: LocationId, __RequestVerificationToken: $(tokenId).val() },
                    function (results) {
                        $("#Period").empty();
                        $("#Period").append("<option value='0'>--Select--</option>");
                        $.each(results.Options, function (index, value) {
                            $("#Period").append("<option value='" + value.Value + "'>" + value.DisplayText + "</option>");

                        });
                    });
                $("#Team").attr('disabled', false);
                $.post('@Url.Action("GetTeamByLocationId", "Rollover")', { LocationId: LocationId, __RequestVerificationToken: $(tokenId).val() },
                function (results) {
                    $("#Team").empty();
                    $("#Team").append("<option value='0'>--All--</option>");
                    $.each(results.Options, function (index, value) {
                        $("#Team").append("<option value='" + value.Value + "'>" + value.DisplayText + "</option>");
                    });
                });
            }
            else {
                $.post('@Url.Action("GetPeriodByTenantId", "Report")', { __RequestVerificationToken: $(tokenId).val() },
                 function (results) {
                     $("#Period").empty();
                     $("#Period").append("<option value='0'>--Select--</option>");
                     $.each(results.Options, function (index, value) {
                         $("#Period").append("<option value='" + value.Value + "'>" + value.DisplayText + "</option>");

                     });
                 });
                $("#Team").empty();
                $("#Team").append("<option value='0'>--All--</option>");
                $("#Team").attr('disabled', true);
            }
        });
    });
    function validatePeriod(PeriodText) {
        if (PeriodText != '--All--')
        { return true; }
        else
        {
            Command: toastr["warning"]("Please select Period");
            return false;
        }
        return true;
    }

    function countFormat(value, row, index) {
        debugger;
        console.log(row);
        return '<a href="javascript:;" style="color:black; text-align: center; padding:10px;" onclick="ShowDetails(this);" class="' + row + '">' + value + '</a>';
    }
    function ShowDetails(el) {
        console.log(el);
        var Date = $('#summaryDate').val();
        var index = el.parentElement.cellIndex;
        var rowHeader = el.closest('td').closest('tr').parentElement.previousElementSibling.firstElementChild.nextElementSibling.firstElementChild;
        var taskType = rowHeader.parentElement.children[index].closest('th').getAttribute('data-field');
        var str = el.parentNode.parentElement.firstElementChild.innerText;
        var locationName = str.split('_')[0];
        var teamName = str.split('_')[1];
        var PeriodText = el.parentNode.parentElement.firstElementChild.nextElementSibling.innerText;
        var PeriodId = $('#Period :selected').val();
        console.log(Date + 'date' + index + 'index' + rowHeader + 'rowHeader' + taskType + 'taskType' + locationName + 'locationName' + teamName + 'teamName')

        taskType = taskType.replace('\n', '');
        $.ajax({
            url: '@Url.Action("summarySubPopupDetail", "Report")',
            data: { locationName: locationName, teamName: teamName, taskType: taskType, inputDate: Date, PeriodId: PeriodId, PeriodText: PeriodText },
            type: "Get",
            contentType: "json",
            success: function (data) {
                $('#myModalContent1').html(data);
                //$('#myModal').modal(options);
                $('#myModal1').modal('show');
                return;
            },
            error: function () {
                alert("Dynamic content load failed.");
            }
        });
    }

    $("#btnSummaryReport").click(function () {
        $("#summaryTitle").show();
        var LocationId = $('#Location :selected').val();
        var PeriodText = $('#Period :selected').text();
        var PeriodId = $('#Period :selected').val();
        var TeamId = $('#Team :selected').val();
        var Date = $('#summaryDate').val();

        if (validatePeriod(PeriodText)) {
            $.ajax({
                url: 'Report/SummeryReport',
                type: 'POST',
                dataType: 'json',
                data: { InputDate: Date, LocationId: LocationId, PeriodId: PeriodId,PeriodText:PeriodText, TeamId: TeamId, __RequestVerificationToken: $(tokenId).val() },
                success: function (data) {
                    console.log(data);
                    SummaryTableData(data.Records);

                },
                error: function () {
                    // $dfd.reject();
                }
            });
        }
        function SummaryTableData(records) {

            if (records != null) {
                $('#tblTaskRecord').bootstrapTable('destroy');
                $('#tblTaskRecord').bootstrapTable({
                    data: records
                });
               // $("#tblTaskRecord").find('td').removeAttr('class');
                $('div[class="fixed-table-loading"]').hide();
                $('#tblTaskRecord').removeAttr("hidden");
            }
        }
    });
</script>
